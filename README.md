# flashcrawl

flashcrawl is a lightweight Puppeteer-backed crawler that captures metadata, HTML, and Markdown from public web pages. It is designed to plug into workflows such as n8n while remaining easy to operate and monitor.

## Features
- `/crawl` endpoint that fetches a URL, follows up to five redirects, and returns structured headers, metadata, optional raw HTML, Markdown, and a SHA-256 hash of the Markdown.
- Content hygiene: scripts, styles, and other non-content tags are stripped before Markdown conversion by default. Opt-in to the full page output with `?fullMarkdown=true`.
- `/status` endpoint exposes uptime, crawl counters, and the latest watchdog observations.
- Watchdog timer warns about event-loop stalls; console output is prettified with `chalk` and `ora` for quick status notes.
- Winston logger writes timestamped log files to the `logs/` directory (one file per day) and can also mirror output to the console.

## Getting Started
1. Install dependencies:
   ```sh
   npm install
   ```
2. Run the server:
   ```sh
   node server.js
   ```
3. The API listens on port `8080` by default. Override with `PORT=3000 node server.js`.

For auto-reload during development, use:
```sh
npm run dev
```

## API Endpoints
- `GET /crawl?url=<targetUrl>[&fullMarkdown=true]` – crawl the provided URL and return structured crawl data. Pass `fullMarkdown=true` to disable sanitation and receive the original markup/markdown.
- `GET /status` – runtime metrics including uptime (seconds), crawl counters, last status code, last error, and latest watchdog observation.
- `POST /convert` – upload a PDF (`file` form field) and receive Markdown generated by `@opendocsg/pdf2md`.

## Configuration
You can configure behaviour through a `.env` file:

| Variable | Description | Default |
| --- | --- | --- |
| `PORT` | Port for the HTTP server. | `8080` |
| `ENABLE_CONSOLE_LOG` | Set to `false` to disable console logging (file logging continues). | `true` |
| `CRAWL_INCLUDE_HTML` | Set to `false` to omit the `body` field in crawl responses unless `fullMarkdown=true` is provided. | `true` |
| `LOG_DIR` | Override the directory used for log files. | `<project>/logs` |

## Response Shape
`/crawl` returns:
```json
{
  "headers": {
    "statusCode": 200,
    "content-encoding": null,
    "content-type": "text/html; charset=utf-8",
    "content-length": 51558,
    "expires": "Sun, 02 Nov 2025 00:35:10 GMT"
  },
  "metadata": {
    "title": "Page Title",
    "description": "Optional summary",
    "h1": ["Top Level Heading"],
    "h2": ["Subheading"]
  },
  "body": "<!DOCTYPE html><html>...</html>",
  "hash": "abc123def456ghi789jkl012mno345pq",
  "markdown": "# Page Title"
}
```

## Notes
- Requires Node.js ≥ 18.
- Puppeteer runs headless Chrome with `--no-sandbox` flags so it can operate in minimal container environments.
- Watchdog warnings and crawl summaries are handled by Winston; if console logging is disabled they remain available in the daily log files.
